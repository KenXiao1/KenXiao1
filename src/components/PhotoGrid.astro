---
import { getCollection } from 'astro:content';
import LikeButton from './LikeButton.tsx';

const { photos } = Astro.props;
---

<div class="columns-1 md:columns-2 lg:columns-3 gap-4 space-y-4">
  {photos.map((photo, index) => (
    <div
      class="break-inside-avoid group relative cursor-zoom-in photo-item"
      data-photo-id={photo.id}
      data-cloudinary-id={photo.data.cloudinaryId}
      data-title={photo.data.title}
      data-date={photo.data.date.toISOString()}
    >
      <div class="rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800">
        <img
          src={(() => {
            const webpSeProxy = import.meta.env.PUBLIC_WEBP_SE_PROXY;
            const transforms = 'w_800,f_auto,q_auto,a_exif';
            return `${webpSeProxy}/image/upload/${transforms}/${photo.data.cloudinaryId}`;
          })()}
          alt={photo.data.title}
          class="max-w-full h-auto mx-auto transform transition-transform duration-500 group-hover:scale-105"
          loading="lazy"
        />
        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors"></div>
        <div class="absolute bottom-0 left-0 right-0 p-4 opacity-0 group-hover:opacity-100 transition-opacity bg-gradient-to-t from-black/60 to-transparent">
          <h3 class="text-white font-bold text-sm">{photo.data.title}</h3>
          <p class="text-white/80 text-xs">{photo.data.date.toLocaleDateString()}</p>
        </div>
      </div>
    </div>
  ))}
</div>

<!-- Pre-render all like buttons (hidden) -->
{photos.map((photo) => (
  <div id={`like-btn-${photo.id}`} class="like-btn-container" style="display: none;">
    <LikeButton
      client:load
      contentType="photo"
      contentId={photo.id}
    />
  </div>
))}
