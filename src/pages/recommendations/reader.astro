---
import NovelReader from '../../components/NovelReader';
import fs from 'fs';
import path from 'path';

const { searchParams } = Astro.url;
const folder = searchParams.get('folder');

if (!folder) {
  return Astro.redirect('/recommendations');
}

// 直接读取 JSON 文件
const readingListPath = path.resolve('./public/reading-list.json');
const readingListData = JSON.parse(fs.readFileSync(readingListPath, 'utf-8'));

// 找到对应的文件夹
const folderData = readingListData.literature.find((item: any) => item.originalName === folder);

if (!folderData || folderData.type !== 'folder') {
  return Astro.redirect('/recommendations');
}
---

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{folderData.name} - 在线阅读器</title>
    <meta name="description" content={`阅读 ${folderData.name}`} />
  </head>
  <body>
    <NovelReader client:load folder={folder} files={folderData.files} />
  </body>
</html>
