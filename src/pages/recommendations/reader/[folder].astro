---
import NovelReader from '../../../components/NovelReader';
import fs from 'fs';
import path from 'path';

// 为静态生成提供所有可能的路径
export async function getStaticPaths() {
  const readingListPath = path.resolve('./public/reading-list.json');
  const readingListData = JSON.parse(fs.readFileSync(readingListPath, 'utf-8'));

  // 只为文件夹类型的 literature 项目生成路径
  const folderItems = readingListData.literature.filter((item: any) => item.type === 'folder');

  const basePath = path.resolve(process.cwd(), '../recommend - some are read some are not - more like a reading list/literature');

  return folderItems.map((item: any) => {
    // 读取文件夹中所有 txt 文件的内容
    const filesWithContent = item.files.map((file: any) => {
      const filePath = path.join(basePath, item.originalName, file.originalName);
      const content = fs.readFileSync(filePath, 'utf-8');
      return {
        ...file,
        content
      };
    });

    return {
      params: { folder: item.originalName },
      props: {
        folderData: {
          ...item,
          files: filesWithContent
        }
      }
    };
  });
}

const { folder } = Astro.params;
const { folderData } = Astro.props;
---

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{folderData.name} - 在线阅读器</title>
    <meta name="description" content={`阅读 ${folderData.name}`} />
  </head>
  <body>
    <NovelReader client:load folder={folder} files={folderData.files} />
  </body>
</html>
