---
import BaseLayout from '../../layouts/BaseLayout.astro';
import fs from 'fs';
import path from 'path';

// 直接读取 JSON 文件而不是 fetch
const readingListPath = path.resolve('./public/reading-list.json');
const readingListData = JSON.parse(fs.readFileSync(readingListPath, 'utf-8'));
---

<BaseLayout title="Ken Xiao | Reading List">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-4xl font-serif font-bold mb-8">Reading List & Resources</h1>

    <!-- Literature -->
    <div class="mb-12">
      <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
        <span class="w-3 h-3 rounded-full bg-purple-500"></span>
        Literature
      </h2>
      <div class="grid gap-3">
        {readingListData.literature.map((item: any) => (
          <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 p-4 rounded-lg hover:shadow-md transition-shadow">
            {item.type === 'folder' ? (
              <div>
                <h3 class="font-bold text-lg mb-2">{item.name}</h3>
                <a
                  href={`/recommendations/reader/${encodeURIComponent(item.originalName)}`}
                  class="inline-block px-4 py-2 text-sm font-medium bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-md hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-colors"
                >
                  在线阅读 ({item.files.length} 篇) &rarr;
                </a>
              </div>
            ) : (
              <h3 class="font-medium">{item.name}</h3>
            )}
          </div>
        ))}
        {readingListData.literature.length === 0 && <p class="text-gray-500 italic">No items yet.</p>}
      </div>
    </div>

    <!-- History -->
    <div class="mb-12">
      <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
        <span class="w-3 h-3 rounded-full bg-blue-500"></span>
        History
      </h2>
      <div class="grid gap-3">
        {readingListData.history.map((item: any) => (
          <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 p-3 rounded-lg hover:shadow-sm transition-shadow">
            <h3 class="font-medium text-sm">{item.name}</h3>
          </div>
        ))}
        {readingListData.history.length === 0 && <p class="text-gray-500 italic">No items yet.</p>}
      </div>
    </div>

    <!-- Other -->
    <div>
      <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
        <span class="w-3 h-3 rounded-full bg-green-500"></span>
        Other
      </h2>
      <div class="grid gap-3">
        {readingListData.other.map((item: any) => (
          <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 p-3 rounded-lg hover:shadow-sm transition-shadow">
            <h3 class="font-medium text-sm">{item.name}</h3>
          </div>
        ))}
        {readingListData.other.length === 0 && <p class="text-gray-500 italic">No items yet.</p>}
      </div>
    </div>
  </div>
</BaseLayout>
