---
import BaseLayout from '../../layouts/BaseLayout.astro';
import AlbumCard from '../../components/AlbumCard.astro';
import { getCollection } from 'astro:content';

const photos = (await getCollection('photos'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout title="Ken Xiao | Photography">
  <div class="max-w-7xl mx-auto">
    <header class="mb-12 text-center">
      <h1 class="text-4xl md:text-6xl font-serif font-bold mb-4">Visual Stories</h1>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      {/* Stickers on Desks Album */}
      <AlbumCard
        title="Stickers on Desks"
        coverImage={photos.find(p => p.data.album === 'stickers-on-desks')?.data.cloudinaryId || photos[0]?.data.cloudinaryId}
        count={photos.filter(p => p.data.album === 'stickers-on-desks').length}
        href="/photography/stickers-on-desks"
      />

      {/* Others Album */}
      <AlbumCard
        title="Others"
        coverImage={photos.find(p => p.data.album === 'others')?.data.cloudinaryId || photos[1]?.data.cloudinaryId}
        count={photos.filter(p => p.data.album === 'others' || !p.data.album).length}
        href="/photography/others"
      />
    </div>
  </div>
</BaseLayout>

<script>
  // Set default background to 'none' for photography page if no preference exists
  const savedTheme = localStorage.getItem('visualTheme');
  
  if (!savedTheme) {
    // Only set default if user hasn't made a choice yet
    localStorage.setItem('visualTheme', 'none');
    
    // Update the select dropdown if it exists
    const visualSelect = document.getElementById('visual-theme-select');
    if (visualSelect) {
      visualSelect.value = 'none';
    }
    
    // Hide the canvas
    const canvas = document.getElementById('bg-canvas');
    if (canvas) {
      canvas.style.display = 'none';
    }
    
    // Dispatch theme change event
    window.dispatchEvent(new CustomEvent('theme-change', { detail: { theme: 'none' } }));
  }
</script>

