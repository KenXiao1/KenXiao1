---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PhotoGrid from '../../components/PhotoGrid.astro';
import { getCollection } from 'astro:content';

const photos = (await getCollection('photos'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout title="Ken Xiao | Photography">
  <div class="max-w-7xl mx-auto">
    <header class="mb-12 text-center">
      <h1 class="text-4xl md:text-6xl font-serif font-bold mb-4">Visual Stories</h1>
    </header>

    {photos.length > 0 ? (
      <PhotoGrid photos={photos} />
    ) : (
      <div class="text-center py-20 border border-dashed border-gray-300 dark:border-gray-700 rounded-xl">
        <p class="text-gray-500 mb-4">Gallery is being curated.</p>
        <p class="text-sm text-gray-400">Photos will appear here once uploaded to Cloudinary.</p>
      </div>
    )}
  </div>
</BaseLayout>

<script>
  // Set default background to 'none' for photography page if no preference exists
  const savedTheme = localStorage.getItem('visualTheme');
  
  if (!savedTheme) {
    // Only set default if user hasn't made a choice yet
    localStorage.setItem('visualTheme', 'none');
    
    // Update the select dropdown if it exists
    const visualSelect = document.getElementById('visual-theme-select');
    if (visualSelect) {
      visualSelect.value = 'none';
    }
    
    // Hide the canvas
    const canvas = document.getElementById('bg-canvas');
    if (canvas) {
      canvas.style.display = 'none';
    }
    
    // Dispatch theme change event
    window.dispatchEvent(new CustomEvent('theme-change', { detail: { theme: 'none' } }));
  }
</script>

